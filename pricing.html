<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing â€” giiHelpdesk</title>
    <meta name="description" content="Choose a plan: Free trial, Pro, or Team.">
    <link rel="stylesheet" href="css/style.css">
    <!-- Paddle Billing v2 loader -->
    <script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
    <script src="js/paddle.js" defer></script>
    <script src="js/common.js" defer></script>
    <script src="js/auth.js" defer></script>
    <style>
        .plan-card__list { margin: 10px 0 16px 0; padding-left: 18px; }
        .plan-card__list li { margin: 6px 0; }
    </style>
    <meta name="robots" content="noindex">
    
</head>
<body>
    <div id="site-header"></div>

    <main class="section" role="main">
        <h1 class="section__title">Pricing</h1>
        <p class="muted">Start your 14-day free trial. No credit card required.</p>

        <div class="pricing" style="margin-top:16px;">
            <article class="plan-card" id="free" data-plan="free">
                <span class="plan-card__badge">14-day trial</span>
                <h2>Free</h2>
                <div class="plan-card__price">$0</div>
                <ul class="plan-card__list">
                    <li>1 seat</li>
                    <li>max 100 emails</li>
                    <li>Gmail Add-on + Shopify integration</li>
                </ul>
                <button class="paddle-btn" data-plan="free" aria-label="Start free trial" id="freePlanBtn">Get Started</button>
            </article>

            <article class="plan-card" data-plan="pro">
                <span class="plan-card__badge">POPULAR</span>
                <h2>Pro</h2>
                <div class="plan-card__price">$79 / mo</div>
                <ul class="plan-card__list">
                    <li>2 seat</li>
                    <li>1,000 emails / month</li>
                    <li>Gmail Add-on + Shopify integration</li>
                </ul>
                <button class="paddle-btn" data-plan="pro" aria-label="Buy Pro" id="proPlanBtn" data-success-url="account/dashboard.html">Buy Pro</button>
            </article>

            <article class="plan-card" data-plan="team">
                <span class="plan-card__badge">HIGH PERFORMANCE</span>
                <h2>Team</h2>
                <div class="plan-card__price">$179 / mo</div>
                <ul class="plan-card__list">
                    <li>10 seats</li>
                    <li>5,000 emails / month</li>
                    <li>Gmail Add-on + Shopify integration</li>
                </ul>
                <button class="paddle-btn" data-plan="team" aria-label="Buy Team" id="teamPlanBtn" data-success-url="account/dashboard.html">Buy Team</button>
            </article>
        </div>

        <section class="section" style="margin-top:24px;">
            <h2 class="section__title">FAQ & Compliance</h2>
            <ul>
                <li><strong>Gmail & Google Workspace</strong> are supported.</li>
                <li><strong>Minimal OAuth scopes</strong>: gmail.readonly, gmail.modify.</li>
                <li><strong>No email content stored</strong>; zero-content-storage design.</li>
                <li><strong>DPA</strong>: handled by Paddle.</li>
            </ul>
        </section>
    </main>

    <div id="site-footer"></div>

    <script>
        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthenticationForPricing();
            applySubscriptionUIState();
        });

        // Authentication check for pricing page
        function checkAuthenticationForPricing() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const isLoggedIn = !!user.token;
            
            if (!isLoggedIn) {
                // Add click event listeners to redirect to login
                const freeBtn = document.getElementById('freePlanBtn');
                const proBtn = document.getElementById('proPlanBtn');
                const teamBtn = document.getElementById('teamPlanBtn');
                
                if (freeBtn && !isLoggedIn) {
                    //only show for non-logged in users
                    freeBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        redirectToLogin('free');
                    });
                }
                
                if (proBtn) {
                    proBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        redirectToLogin('pro');
                    });
                }
                
                if (teamBtn) {
                    teamBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        redirectToLogin('team');
                    });
                }
            } else {
                // User is logged in, check for plan parameter
                console.log("checkAuthenticationForPricing: user plan is ", user.subscription.plan);
                const plan = user.subscription.plan;
                
                if (plan) {
                    // Highlight the selected plan
                    highlightSelectedPlan(plan);
                }
            }
        }

        // Apply subscription state to pricing UI
        function applySubscriptionUIState() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const sub = user.subscription || null;

            const freeBtn = document.getElementById('freePlanBtn');
            const proBtn = document.getElementById('proPlanBtn');
            const teamBtn = document.getElementById('teamPlanBtn');

            const proBadge = document.querySelector('[data-plan="pro"] .plan-card__badge');
            const teamBadge = document.querySelector('[data-plan="team"] .plan-card__badge');

            // Default: nothing to do if no subscription info
            if (!sub || !sub.status) {
                return;
            }

            // 1) After login, free button disabled for all logged-in users
            if (freeBtn) {
                freeBtn.disabled = true;
                freeBtn.textContent = 'Free trial';
                freeBtn.setAttribute('aria-disabled', 'true');
            }

            // 2) Manage Pro/Team based on plan
            // Normalize plan
            const plan = (sub.plan || '').toLowerCase();
            const isActive = sub.status === 'active';

            if (plan === 'pro' && isActive) {
                if (proBadge) { proBadge.textContent += '  (Subscribed)'; }
                if (proBtn) {
                    proBtn.disabled = true;
                    proBtn.textContent = 'Current Plan';
                    proBtn.setAttribute('aria-disabled', 'true');
                }
            }

            if (plan === 'team' && isActive) {
                if (teamBadge) { teamBadge.textContent += '  (Subscribed)'; }
                if (proBtn) {
                    proBtn.disabled = true;
                    proBtn.textContent = 'Pro Plan';
                    proBtn.setAttribute('aria-disabled', 'true');
                }
                if (teamBtn) {
                    teamBtn.disabled = true;
                    teamBtn.textContent = 'Current Plan';
                    teamBtn.setAttribute('aria-disabled', 'true');
                }
            }
        }

        // Highlight selected plan
        function highlightSelectedPlan(plan) {
            // Remove any existing highlights
            document.querySelectorAll('.plan-card').forEach(card => {
                card.style.border = '2px solid #e9ecef';
            });
            
            // Highlight the selected plan
            const selectedCard = document.querySelector(`[data-plan="${plan}"]`).closest('.plan-card');
            console.log("highlightSelectedPlan: selectedCard", selectedCard);
            if (selectedCard) {
                selectedCard.style.border = '2px solid var(--color-primary)';
                selectedCard.style.boxShadow = '0 0 0 3px rgba(10, 117, 255, 0.1)';
            }
        }

        // Redirect to login with plan parameter
        function redirectToLogin(plan) {
            const loginUrl = `auth/login.html?redirect=pricing&plan=${plan}`;
            window.location.href = loginUrl;
        }
    </script>

</body>
</html>


